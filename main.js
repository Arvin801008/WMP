const playlist = [
  {
    src: "audio/Revisited.m4a",
    title: "Revisited",
    artist: "Khalil Fong",
    cover: "album/The dreamer.png",
    lyrics: `悔不悔? 離別之後
會不會又上心頭?
我惦著你在時間裡洄游
以為能忘記 但是我還沒有
揮不揮鬆開的手?
會不會覆水能收?
我在這裡試著撫平愧疚
無人回應我的祈求
弄丟了愛 失去了你 I'm so sorry
再會我的愛 終究會釋懷
再會的那天 我心還在
回憶把我們留了下來
Let's go back to the place
Where I first saw your face girl
退不回 只好等候
會不會淡掉傷口?
我向前走 不知過了多久
無人回應我的祈求
弄丟了愛 失去了你 I'm so sorry
再會我的愛 終究會釋懷
再會的那天 我心還在
回憶把我們留了下來
Let's go back to the place
Where I first saw your face girl
一切彷彿昨天 想你的習慣沒有改變
時光不會倒流 往事不會重來
但回憶的美好 每一分都保留
讓我們笑著擦身而過
再會我的愛 我的愛
再會終究會釋懷
那天我心還在 把回憶留下來
So, let's go back
Let's go back to the place`,
  },
  {
    src: "audio/Older.m4a",
    title: "Older",
    artist: "Sasha Alex Sloan",
    cover: "album/Older.png",
    lyrics: `I used to shut my door while my mother screamed in the kitchen
I'd turn the music up, get high and try not to listen
To every little fight, 'cause neither one was right
I swore I'd never be like them
But I was just a kid back then
The older I get the more that I see
My parents aren't heroes, they're just like me
And loving is hard, it don't always work
You just try your best not to get hurt
I used to be mad but now I know
Sometimes it's better to let someone go
It just hadn't hit me yet
The older I get
I used to wonder why, why they could never be happy
I used to close my eyes and pray for a whole 'nother family
Where everything was fine, one that felt like mine
I swore I'd never be like them
But I was just a kid back then
The older I get the more that I see
My parents aren't heroes, they're just like me
And loving is hard, it don't always work
You just try your best not to get hurt
I used to be mad but now I know
Sometimes it's better to let someone go
It just hadn't hit me yet
The older I get
The older I get the more that I see
My parents aren't heroes, they're just like me
And loving is hard, it don't always work
You just try your best not to get hurt
I used to be mad but now I know
Sometimes it's better to let someone go
It just hadn't hit me yet
The older I get`,
  },
  {
    src: "audio/How_Long_Will_I_Love_You.m4a",
    title: "How Long Will I Love You",
    artist: "About Time",
    cover: "album/How_Long_Will_I_Love_You.png",
    lyrics: `How long will I love you?
As long as stars are above you
And longer if I can
How long will I need you?
As long as the seasons need to
Follow their plan
How long will I be with you?
As long as the sea is bound to
Wash upon the sand
How long will I want you?
As long as you want me to
And longer by far
How long will I hold you?
As long as your father told you
As long as you can
How long will I give to you?
As long as I live through you
However long you say
How long will I love you?
As long as stars are above you
And longer if I may
How long will I love you?
As long as stars are above you`,
  },
  {
    src: "audio/Master_Q.m4a",
    title: "Master Q",
    artist: "Waa Wei",
    cover: "album/Master_Q.png",
    lyrics: `「你好嗎？」
不用急著回答
不知道怎麼說也沒關係
對了 那間好吃餐廳收掉了
啊 剛剛要說什麼我忘記了
都幾歲了還像孩子一樣
不知道大人要怎麼當
你看 雨傘丟在車上又沒拿
你看 最近長了一些白頭髮
你還是你嗎？
喝多了才敢說出真心話（然後打電話
哭得唏哩嘩啦（嗚哇嗚哇
多想抱緊你 可惜沒那種運氣
你有想我嗎？
早就習慣自問自答（有嗎有啊
44次的日落（嗚哇嗚哇
找不到像你的 可能沒那種命
都幾歲了還像孩子一樣
不知道大人要怎麼當
你看 雨傘丟在車上又沒拿
你看 最近長了一些白頭髮
失眠的城市依然喧囂
緊迫的時間彎曲每個人的腰
牙一咬算過得去吧
如果你在就好了⋯
你還是你嗎？
喝多了才敢說出真心話（然後打電話
哭得唏哩嘩啦（嗚哇嗚哇
多想抱緊你 可惜沒那種運氣
你有想我嗎？
早就習慣自問自答（有嗎有啊
44次的日落（嗚哇嗚哇
找不到像你的 可能沒那種命
今天是我的生日
你還記得嗎？
先這樣吧
「你好好的。」`,
  },
  {
    src: "audio/Seventeen.m4a",
    title: "Seventeen",
    artist: "Sjowgren",
    cover: "album/Seventeen.png",
    lyrics: `I know I can't (I know I can't)
I can't be everything
All in one (all in one)
Just the one for you
We make up, up some pieces (pieces)
Puzzle pieces
We'll fit, all adding up
We'll fit, all adding up
Ooh
If you want
A second to breathe
I'll give you all of my love
I'll give you all that you need
Oh, don't worry
I'm not in a hurry, not going nowhere
I'm not going nowhere, yeah
If you want
A second to breathe
I'll give you all of my love
I'll give you all that you need
Oh, don't worry
I'm not in a hurry, not going nowhere
I'm not going nowhere, yeah
Ooh, well
Ooh, ooh, ooh, ooh
Ooh, well
Ooh, ooh, ooh, ooh
A balance act (a balance act)
I fill up everything
Down to one (down to one)
Just the one, it's you
You make up, up a pieces (pieces)
Favorite piece and
You fit, all adding up
You fit, all adding up
Ba-da-da-da-da bum, ba-dum
Ba-da-da-da-da bum, ba-dum
Ooh, ooh, ooh
Ba-da-da-da-da bum, ba-dum
Ba-da-da-da-da bum
Ba-da-da-da-da bum
Ba-da-da-da-da bum (ooh)
If you want
A second to breathe
I'll give you all of my love
Give you all that you need
Oh, don't worry
I'm not in a hurry, not going nowhere
I'm not going nowhere, yeah
If you want
A second to breathe
I'll give you all of my love
I'll give you all that you need
Oh, don't worry
I'm not in a hurry, not going nowhere
I'm not going nowhere, yeah
Ooh, well
Ooh, ooh, ooh, ooh
Ooh, well
Ooh, ooh, ooh, ooh
I'm
Coming up with all the things
So won't
So won't you come and join me
Life
Life can deal some crazy things
Don't worry
Don't you worry, we'll find it
If you want
A second to breathe
I'll give you all of my love
I'll give you all that you need
Oh, don't worry
I'm not in a hurry, not going nowhere
I'm not going nowhere, yeah
If you want
A second to breathe
I'll give you all of my love
I'll give you all that you need
Oh, don't worry
I'm not in a hurry, not going nowhere
I'm not going nowhere, yeah`,
  },
  {
    src: "audio/Snowfall_at_Night.m4a",
    title: "Snowfall at Night",
    artist: "D.O",
    cover: "album/Snowfall_at_Night.png",
    lyrics: `안녕, 오랜만에, 다시 돌아왔네
거짓말 같던 너의 계절
찬 바람이 불 즈음 포근한 거리엔
네가 많아서 웃음 짓곤 해
잊지 않을게, 서툰 밤을 끌어안던
우린 어제처럼 남아있어
눈처럼 하얗게 소복 쌓인 둘
가장 사랑했던 모습 그대로
hm-mm-hm
(Ooh-ooh-ooh) hm-hm-hm-hm, hm
다정하게 웃고 빈틈없이 안고
나란히 누워 꿈을 꾸지
품에 넘치는 마음, 추운 줄 몰랐어 (hm-hm)
너로 벅차고 눈부신 겨울
잊지 않을게, 서툰 밤을 끌어안던 (ah-ah-ah)
우린 어제처럼 남아있어 (ah-ah-ah)
눈처럼 하얗게 반짝이는 둘 (ah-ah-ah)
가장 사랑했던 모습 그대로
Ah-ah-ah, ah-ah-ah
눈을 감고서 지나간 우릴 세어본다
Ah-ah-ah, ah-ah-ah
눈을 감으면, 영원이라 말하는 둘`,
  },
  {
    src: "audio/Spirits.m4a",
    title: "Spirits",
    artist: "The Strumbellas",
    cover: "album/Spirits.png",
    lyrics: `I got guns in my head and they won't go
Spirits in my head and they won't go
I got guns in my head and they won't go
Spirits in my head and they won't
I've been lookin' at the stars tonight
And I think, oh, how I miss that bright sun
I'll be a dreamer 'til the day I die
And they say, oh, how the good die young?
But we're all strange
And maybe we don't want to change
I got guns in my head and they won't go
Spirits in my head and they won't go
I got guns in my head and they won't go
Spirits in my head and they won't go
But the gun still rattles, the gun still rattles, oh
I got guns in my head and they won't go
Spirits in my head and they won't go
I spend a lot of nights on the run
And I think, oh, like I'm lost and can't be found
I'm just waiting for my day to come
And I think, oh, I don't wanna let you down
'Cause something inside has changed
And maybe we don't wanna stay the same
I got guns in my head and they won't go
Spirits in my head and they won't go
I got guns in my head and they won't go
Spirits in my head and they won't go
But the gun still rattles, the gun still rattles, oh
But the gun still rattles, the gun still rattles, oh
And I don't want a never-ending life
I just want to be alive
While I'm here
And I don't want a never-ending life
I just want to be alive
While I'm here
And I don't want to see another night
Lost inside of lonely life
While I'm here
I got guns in my head and they won't go
Spirits in my head and they won't go
I got guns in my head and they won't go
Spirits in my head and they won't go
But the gun still rattles, the gun still rattles, oh
But the gun still rattles, the gun still rattles, oh`,
  },
  {
    src: "audio/That's_okay.m4a",
    title: "That's okay",
    artist: "D.O",
    cover: "album/That's_okay.png",
    lyrics: `숱하게 스쳐 간
감정들에 무뎌지는 감각
언제부턴가 익숙해져 버린
마음을 숨기는 법들 wow wow
난 어디쯤에 와 있나
앞만 보고 달려오기만 했던
돌아보는 것도 왠지 겁이 나
미뤄둔 얘기들
시간이 가듯 내 안엔
행복했었던 때론
가슴이 저릴 만큼 눈물겨운 날도
매일 같이 뜨고 지는 태양과
저 달처럼 자연스레 보내
때론 울고 (hey yo) 때론 웃고 (hey yo)
기대하고 (hey yo) 아파하지 (hey yo)
다시 설레고 (hey yo) 무뎌지고 (hey yo)
마음이 가는 대로 있는 그대로
수많은 별이 그랬듯이
언제나 같은 자리
제 몫의 빛으로 환하게 비출 테니
숨기지 말고 너를 보여줄래 편히
네 모습 그대로 그래 괜찮아 괜찮아도
오늘 난 처음으로
솔직한 내 마음을 마주해
거울 앞에 서는 것도 머뭇대
이 표정은 또 왜 이리도 어색해
아름다운 건 늘 소중하고
잠시 머물다 아득히 멀어져도
늘 마주 보듯 평범한 일상을 채울 마음의 눈
그 안에 감춰둔 외로움도
잠시 머물 수 있게 해
그저 바라봐
부드러운 바람이 불면
마음을 열어 지나갈 하루야
때론 울고 (hey yo) 때론 웃고 (hey yo)
기대하고 (hey yo) 아파하지 (hey yo)
다시 설레고 (hey yo) 무뎌지고 (hey yo)
마음이 가는 대로 있는 그대로
수많은 별이 그랬듯이
언제나 같은 자리에
제 몫의 빛으로 환하게 비출 테니
숨기지 말고 너를 보여줄래 편히
네 모습 그대로 그래 괜찮아 괜찮아도
두 손에 가득 채워질 추억들은 oh oh oh
소중한 우리 이야기
진심이 담긴 마음이
시간이 지나 다시 기억할 수 있다면
말할 수 있을까
너도 행복했다고
너와 울고 (hey yo) 같이 웃고 (hey yo)
기대하고 (hey yo) 아파했지 (hey yo)
모든 걸 쏟고 (hey yo) 사랑하고 (hey yo)
마음이 가는 대로 있는 그대로
말하지 못할 고민거리
깊게 상처 난 자리
늘 같은 속도로 흘러가는 시간이
언제나 그랬듯이 씻어내 줄 테니
흐르듯 살아도 그냥 괜찮아 괜찮아도`,
  },
  {
    src: "audio/What_Was_I_Made_For.m4a",
    title: "What Was I Made For",
    artist: "Billie Eilish",
    cover: "album/What_Was_I_Made_For.png",
    lyrics: `I used to float, now I just fall down
I used to know but I'm not sure now
What I was made for
What was I made for?
Takin' a drive, I was an ideal
Looked so alive, turns out I'm not real
Just something you paid for
What was I made for?
'Cause I, I
I don't know how to feel
But I wanna try
I don't know how to feel
But someday, I might
Someday, I might
When did it end? All the enjoyment
I'm sad again, don't tell my boyfriend
It's not what he's made for
What was I made for?
'Cause I, 'cause I
I don't know how to feel
But I wanna try
I don't know how to feel
But someday I might
Someday I might
Think I forgot how to be happy
Something I'm not, but something I can be
Something I wait for
Something I'm made for
Something I'm made for`,
  },

  // 可依序加入
];

let currentIndex = 0;
let isShuffle = false;
let isRepeat = false;
let isPlaying = false;

// 音訊
const audio = new Audio();
audio.src = playlist[currentIndex];

// DOM 
const playBtnImg = document.querySelector(".icon-playpause");
const progressBar = document.getElementById("progress-bar");
const currentTimeEl = document.getElementById("current-time");
const durationEl = document.getElementById("duration");
const volumeBar = document.getElementById("volume-bar");

const btnAdd = document.querySelector(".btn-add");
const iconAdd = btnAdd.querySelector("img");
let isAdded = false;

const btnHeart = document.querySelector(".btn-heart");
const iconHeart = btnHeart.querySelector("img");
let isFavorited = false;

// 初始化
progressBar.value = 0;
currentTimeEl.textContent = "0:00";
durationEl.textContent = "0:00";
volumeBar.value = 75;
audio.volume = 0.75;
updateRangeFill(progressBar);
updateRangeFill(volumeBar);

changeSong(currentIndex);

renderPlaylist();
changeSong(currentIndex);

// 播放 / 暫停
playBtnImg?.parentElement.addEventListener("click", () => {
  if (isPlaying) {
    audio.pause();
    playBtnImg.src = "icons/play.svg";
  } else {
    audio.play();
    playBtnImg.src = "icons/pause.svg";
  }
  isPlaying = !isPlaying;
});

// 加入播放清單
btnAdd?.addEventListener("click", () => {
  isAdded = !isAdded;
  iconAdd.src = isAdded ? "icons/check.svg" : "icons/plus.svg";
});

// 收藏歌曲
btnHeart?.addEventListener("click", () => {
  isFavorited = !isFavorited;
  iconHeart.src = isFavorited ? "icons/Heart check.svg" : "icons/heart.svg";
});

// 音訊載入
audio.addEventListener("loadedmetadata", () => {
  durationEl.textContent = formatTime(audio.duration);
  progressBar.max = Math.floor(audio.duration);
  updateRangeFill(progressBar);
});

// 播放進度更新
audio.addEventListener("timeupdate", () => {
  progressBar.value = Math.floor(audio.currentTime);
  currentTimeEl.textContent = formatTime(audio.currentTime);
  updateRangeFill(progressBar);
});

// 播放結束事件處理
audio.addEventListener("ended", () => {
  if (isRepeat) {
    audio.currentTime = 0;
    audio.play();
  } else {
    playNext();
  }
});

// 拖拉進度條
progressBar?.addEventListener("input", () => {
  audio.currentTime = progressBar.value;
  updateRangeFill(progressBar);
});

// 音量調整
volumeBar?.addEventListener("input", () => {
  audio.volume = volumeBar.value / 100;
  updateRangeFill(volumeBar);
});

// 上一首
document.querySelector(".btn-skipBack")?.addEventListener("click", () => {
  currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
  changeSong(currentIndex);
});

// 下一首
document.querySelector(".btn-skipForward")?.addEventListener("click", () => {
  playNext();
});

// 隨機播放
const btnShuffle = document.querySelector(".btn-shuffle");
btnShuffle?.addEventListener("click", () => {
  isShuffle = !isShuffle;
  btnShuffle.classList.toggle("active", isShuffle);
});

// 循環播放
const btnRepeat = document.querySelector(".btn-repeat");
btnRepeat?.addEventListener("click", () => {
  isRepeat = !isRepeat;
  btnRepeat.classList.toggle("active", isRepeat);
});

// 自動播放下一首邏輯
function playNext() {
  if (isShuffle && playlist.length > 1) {
    let next;
    do {
      next = Math.floor(Math.random() * playlist.length);
    } while (next === currentIndex);
    currentIndex = next;
  } else {
    currentIndex = (currentIndex + 1) % playlist.length;
  }
  changeSong(currentIndex);
}

// 切換歌曲
function changeSong(index) {
  currentIndex = index;
  const currentSong = playlist[index];

  audio.src = currentSong.src;
  audio.load();
  audio.play();
  isPlaying = true;
  playBtnImg.src = "icons/pause.svg";

  // 更新畫面資訊
  document.getElementById("cover-img").src = currentSong.cover;
  document.getElementById("song-title").textContent = currentSong.title;
  document.getElementById("song-artist").textContent = currentSong.artist;
  document.getElementById("lyrics-content").innerText = currentSong.lyrics;

  document.querySelectorAll(".playlist-item").forEach((item) => {
    item.classList.remove("active");
  });
  document.querySelector(`.playlist-item[data-index="${index}"]`)?.classList.add("active");
}

// 格式化時間（mm:ss）
function formatTime(time) {
  const min = Math.floor(time / 60);
  const sec = Math.floor(time % 60);
  return `${min}:${sec.toString().padStart(2, "0")}`;
}

// 更新滑動背景
function updateRangeFill(rangeEl) {
  const value = (rangeEl.value / rangeEl.max) * 100;
  rangeEl.style.background = `linear-gradient(to right, var(--color-primary) ${value}%, var(--color-gray) ${value}%)`;
}

// tab 切換與播放區版面控制
const tabBtns = document.querySelectorAll(".tab-btn");
const playingTab = document.querySelector(".tab-content.playing");

tabBtns.forEach((btn) => {
  btn.addEventListener("click", () => {
    const target = btn.dataset.tab;

    // 切換 tab 樣式
    tabBtns.forEach((b) => b.classList.remove("active"));
    btn.classList.add("active");

    // 切換內容區塊
    document.querySelectorAll(".tab-content").forEach((tab) => {
      tab.classList.remove("active");
    });

    // 只啟用 playing 區塊
    if (["playing", "lyrics", "playlist"].includes(target)) {
      playingTab.classList.add("active");
    } else {
      document.querySelector(`.tab-content.${target}`)?.classList.add("active");
    }

    // 重設 layout
    playingTab.classList.remove("split-layout", "split-lyrics", "split-playlist");

    if (target === "lyrics") {
      playingTab.classList.add("split-layout", "split-lyrics");
    } else if (target === "playlist") {
      playingTab.classList.add("split-layout", "split-playlist");
    }
  });
});
// //點擊播放歌曲
// document.querySelectorAll(".playlist-item").forEach((item) => {
//   item.addEventListener("click", () => {
//     const index = parseInt(item.dataset.index);
//     if (!isNaN(index)) {
//       changeSong(index);
//     }
//   });
// });

function renderPlaylist() {
  const playlistContainer = document.querySelector(".playlist-content");
  playlistContainer.innerHTML = ""; // 先清空

  playlist.forEach((song, index) => {
    const li = document.createElement("li");
    li.classList.add("playlist-item");
    li.dataset.index = index;
    li.textContent = `${song.title} - ${song.artist}`;
    playlistContainer.appendChild(li);

    // 點擊播放
    li.addEventListener("click", () => {
      changeSong(index);
    });
  });
}